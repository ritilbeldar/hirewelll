<%- include('partials/nav.ejs') %>
   <div class="layout-content">
      <div class="container-fluid flex-grow-1 container-p-y">
         <div class="row">
            <div class="col-md-6">
               <h4 class="font-weight-bold py-3 mb-0">
                  Teachers
               </h4>
               <div class="text-muted small mt-0 mb-4 d-block breadcrumb">
                  <ol class="breadcrumb">
                     <li class="breadcrumb-item"><a href="/admin/dashboard"><i class="feather icon-home"></i></a></li>
                     <li class="breadcrumb-item"><a href="/admin/dashboard">Dashboard</a></li>
                     <li class="breadcrumb-item"><a href="/admin/teachers">Teachers</a></li>
                  </ol>
               </div>
            </div>
            <div class="col-sm-6 text-right mt-4">
               <a href="/admin/dashboard/addressView" class="btn btn-success btn-sm btn-round mb-3"><i
                     class="feather icon-plus"></i> Add address</a>
            </div>
         </div>
         <div class="row">
            <div class="row">
               <div class="col-lg-12">
                  <div class="row g-3">
                     <div class="col-md-3">
                        <h6 class="card-header">Month</h6>
                        <div class="home-select">
                           <span>
                              <button id="daterange-4" class="btn btn-default dropdown-toggle md-btn-flat"></button>
                           </span>
                        </div>
                     </div>
                     <div class="col-md-2">
                        <h6 class="card-header mb-2">City</h6>
                        <div class="home-select" id="home-select2">
                           <select id="cityFilter" class="selectpicker selectpicker1" data-style="btn-default"
                              data-live-search="true">
                              <option value="">--select--</option>
                              <% const uniqueCities=new Set(); students.reverse().forEach((student, index)=> {
                                 const city = student.city;
                                 if (!uniqueCities.has(city)) { %>
                                 <option value="<%= city %>" class="td">
                                    <%= city %>
                                 </option>
                                 <% } }); %>
                           </select>
                        </div>
                     </div>
                     <div class="col-md-2">
                        <h6 class="card-header mb-2">Area</h6>
                        <div class="home-select" id="home-select2">
                           <select id="schoolTypeFilter" class="selectpicker selectpicker1" data-style="btn-default"
                              data-live-search="true">
                              <option value="">--select--</option>
                              <% const uniqueCities1=new Set(); students.reverse().forEach((teacher, index)=> {
                                 const address = teacher.address;
                                 if (!uniqueCities1.has(address)) {
                                 uniqueCities1.add(address);%>
                                 <option value="<%= address %>" class="td">
                                    <%= address %>
                                 </option>
                                 <%}});%>
                           </select>
                        </div>
                     </div>
                     <div class="col-md-2">
                        <h6 class="card-header mb-2">Pincode</h6>
                        <div class="home-select" id="home-select2">
                           <select id="roleFilter" class="selectpicker selectpicker1" data-style="btn-default"
                              data-live-search="true">
                              <option value="">--select--</option>
                              <% const uniqueCities2=new Set(); students.reverse().forEach((teacher, index)=> {
                                 const pincode = teacher.pincode;
                                 if (!uniqueCities2.has(pincode)) {
                                 uniqueCities2.add(pincode);%>
                                 <option value="<%= pincode %>" class="td">
                                    <%= pincode %>
                                 </option>
                                 <%}});%>
                           </select>
                        </div>
                     </div>
                     <div class="col-md-2">
                        <h6 class="card-header mb-2">Qualification</h6>
                        <div class="home-select" id="home-select5">
                           <select id="qualificationFilter" class="selectpicker" data-style="btn-default"
                              data-live-search="true">
                              <option value="">--select--</option>
                              <option value="Diploma">Diploma</option>
                              <option value="Master Degree">Master Degree</option>
                              <option value="Bechelor Degree">Bechelor Degree</option>
                              <option value="Doctorate Degree">Doctorate Degree</option>
                              <option value="Other">Other</option>
                           </select>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="col-lg-12 mt-5">
                  <div class="row">
                     <div class="col-xl-3 col-6">
                        <div class="card mb-4 bg-success text-white">
                           <div class="card-body">
                              <div class="d-flex flex-column align-items-center justify-content-between">
                                 <h2>Total</h2>
                                 <div class="d-flex flex-column align-items-center">
                                    <h2 class="mt-2">
                                       <%= students.length %>
                                    </h2>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="col-md-3 col-6">
                        <div class="card mb-4 text-white" style="background-color: #007BFF;">
                           <div class="card-body">
                              <div class="d-flex flex-column align-items-center justify-content-between">
                                 <h2>Today</h2>
                                 <div class="d-flex flex-column align-items-center">
                                    <h2 class="mt-2">
                                       <% let todayCount=0; students.forEach((teacher)=> {
                                          const createdAtDate = new Date(teacher.createdAt);
                                          const today = new Date();

                                          if (
                                          createdAtDate.getDate() === today.getDate() &&
                                          createdAtDate.getMonth() === today.getMonth() &&
                                          createdAtDate.getFullYear() === today.getFullYear()
                                          ) {
                                          todayCount++;
                                          }
                                          });
                                          %>
                                          <%= todayCount %>
                                    </h2>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="col-md-3 col-6">
                        <div class="card mb-4 bg-warning text-white">
                           <div class="card-body">
                              <div class="d-flex flex-column align-items-center justify-content-between">
                                 <h2>Active</h2>
                                 <div class="d-flex flex-column align-items-center">
                                    <h2 class="mt-2">
                                       <% const desiredStatusActive='Active' ; %>
                                          <% const studentsWithActiveStatus=students.filter(student=> student.status ===
                                             desiredStatusActive); %>
                                             <%= studentsWithActiveStatus.length %>
                                    </h2>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="col-md-3 col-6">
                        <div class="card mb-4 bg-danger text-white">
                           <div class="card-body">
                              <div class="d-flex flex-column align-items-center justify-content-between">
                                 <h2>Inactive</h2>
                                 <div class="d-flex flex-column align-items-center">
                                    <h2 class="mt-2">
                                       <% const desiredStatusInactive='Inactive' ; %>
                                          <% const studentsWithInactiveStatus=students.filter(student=> student.status
                                             === desiredStatusInactive); %>
                                             <%= studentsWithInactiveStatus.length %>
                                    </h2>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="col-sm-12">
               <div class="card">
                  <div class="card-body">
                     <div class="row align-items-center m-l-0">
                        <div class="col-sm-6">
                        </div>
                        <div class="col-sm-6 text-right">
                           <a href="/admin/teacher_add"><button class="btn btn-success btn-sm mb-3"><i
                                    class="feather icon-plus"></i> Add Teacher</button></a>
                        </div>
                     </div>

                     <div id="toolbar">
                        <button class="btn btn-success mb-3" onclick="exportToExcel()">
                           <i class="fa fa-file-excel-o"></i> Export to Excel
                        </button>
                     </div>

                     <div class="table-responsive">
                        <table id="report-table-page1" class="table table-striped table-hover report-table-page1"
                           data-click-to-select="true" data-toolbar="#toolbar" data-show-toggle="true"
                           data-show-columns="true" data-url="">
                           <thead>
                              <tr>
                                 <th>S NO.</th>
                                 <th>Status</th>
                                 <th>Action</th>
                                 <th>Resume</th>
                                 <th>Date</th>
                                 <th>Name</th>
                                 <th>Gender</th>
                                 <th>Email</th>
                                 <th>Number</th>
                                 <th>Whatsapp No.</th>
                                 <th>School Type</th>
                                 <th>Role</th>
                                 <th>Currently Working</th>
                                 <th>Relevant Experience</th>
                                 <th>Qualification Level</th>
                                 <th>City</th>
                                 <th>State</th>
                                 <th>Pincode</th>
                              </tr>
                           </thead>
                           <tbody class="table-new">
                              <% students.forEach((teacher, index)=> { %>
                                 <tr>
                                    <td>
                                       <%= index + 1 %>
                                       <% if (teacher.openings.length > 0) { %>
                                         <i class="fa-solid fa-circle-dot"></i>
                                       <% } %>
                                       <% if (teacher.training.length > 0) { %>
                                         <i class="fa-solid fa-circle-dot fa-circle-dot1"></i>
                                       <% } %>
                                     </td>
                                    <td>
                                       <form action="/admin/teacher_status" method="post">
                                          <input type="hidden" name="student" value="<%= teacher._id %>">
                                          <button type="submit"
                                             class="btn <%= teacher.status === 'Active' ? 'btn-success' : 'btn-danger' %> toggle-status"
                                             name="status">
                                             <%= teacher.status %>
                                          </button>
                                       </form>
                                    </td>
                                    <td>
                                       <a href="/admin/teacher_details/<%= teacher._id %>"
                                          class="btn btn-info btn-sm"><i class="feather icon-eye"></i></a>
                                       <a href="/admin/teacher_edit/<%= teacher._id %>" class="btn btn-info btn-sm"><i
                                             class="feather icon-edit"></i> </a>

                                       <a href="/admin/teacher_delete/<%= teacher._id %>"
                                          class="btn btn-danger btn-sm delete-btn" data-teacher-id="<%= teacher._id %>">
                                          <i class="feather icon-trash-2"></i>
                                       </a>
                                    </td>
                                    <td><a class="btn btn-primary btn-sm" href="<%= teacher.teacherresume.url %>"
                                          target="_blank">View</a></td>
                                    <td>
                                       <%= teacher.createdAt.toLocaleDateString() %>
                                    </td>
                                    <td class="td">
                                       <%= teacher.firstname %>
                                          <%= teacher.lastname %>
                                    </td>
                                    <td class="td">
                                       <%= teacher.gender %>
                                    </td>
                                    <td>
                                       <%= teacher.email %>
                                    </td>
                                    <td>
                                       <%= teacher.contact %>
                                    </td>
                                    <td>
                                       <%= teacher.whatsappNumber %>
                                    </td>
                                    <td class="td">
                                       <%= teacher.schoolType %>
                                    </td>
                                    <td class="td">
                                       <%= teacher.role %>
                                    </td>
                                    <td class="td">
                                       <%= teacher.isCurrentlyWorking %>
                                    </td>
                                    <td>
                                       <%= teacher.relevantExperience %>
                                    </td>
                                    <td class="td">
                                       <%= teacher.qualificationLevel %>
                                    </td>
                                    <td class="td">
                                       <%= teacher.city %>
                                    </td>
                                    <td class="td">
                                       <%= teacher.state %>
                                    </td class="td">
                                    <td>
                                       <%= teacher.pincode %>
                                    </td>
                                 </tr>
                                 <% }); %>
                           </tbody>
                        </table>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <div class="modal fade" id="modal-report" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
         aria-hidden="true">
         <div class="modal-dialog  modal-lg">
            <div class="modal-content">
               <div class="modal-header px-3">
                  <h5 class="modal-title">Add Address</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                     <span aria-hidden="true">&times;</span>
                  </button>
               </div>
               <div class="modal-bod1">
                  <form action="/admin/addressSave" method="post">
                     <div class="row">
                        <div class="col-md-6">
                           <h6>State*</h6>
                           <div class="input-group">
                              <select class="" data-style="" data-live-search="true" name="state">
                                 <option selected>Select State</option>
                                 <option value="Andhra Pradesh">Andhra Pradesh
                                 </option>
                                 <option value="Andaman and Nicobar Islands">
                                    Andaman and Nicobar Islands
                                 </option>
                                 <option value="Arunachal Pradesh">Arunachal
                                    Pradesh
                                 </option>
                                 <option value="Assam">Assam</option>
                                 <option value="Bihar">Bihar</option>
                                 <option value="Chandigarh">Chandigarh</option>
                                 <option value="Chhattisgarh">Chhattisgarh
                                 </option>
                                 <option value="Dadar and Nagar Haveli">Dadar and
                                    Nagar Haveli
                                 </option>
                                 <option value="Daman and Diu">Daman and Diu
                                 </option>
                                 <option value="Delhi">Delhi</option>
                                 <option value="Lakshadweep">Lakshadweep</option>
                                 <option value="Puducherry">Puducherry</option>
                                 <option value="Goa">Goa</option>
                                 <option value="Gujarat">Gujarat</option>
                                 <option value="Haryana">Haryana</option>
                                 <option value="Himachal Pradesh">Himachal
                                    Pradesh
                                 </option>
                                 <option value="Jammu and Kashmir">Jammu and
                                    Kashmir
                                 </option>
                                 <option value="Jharkhand">Jharkhand</option>
                                 <option value="Karnataka">Karnataka</option>
                                 <option value="Kerala">Kerala</option>
                                 <option value="Madhya Pradesh">Madhya Pradesh
                                 </option>
                                 <option value="Maharashtra">Maharashtra</option>
                                 <option value="Manipur">Manipur</option>
                                 <option value="Meghalaya">Meghalaya</option>
                                 <option value="Mizoram">Mizoram</option>
                                 <option value="Nagaland">Nagaland</option>
                                 <option value="Odisha">Odisha</option>
                                 <option value="Punjab">Punjab</option>
                                 <option value="Rajasthan">Rajasthan</option>
                                 <option value="Sikkim">Sikkim</option>
                                 <option value="Tamil Nadu">Tamil Nadu</option>
                                 <option value="Telangana">Telangana</option>
                                 <option value="Tripura">Tripura</option>
                                 <option value="Uttar Pradesh">Uttar Pradesh
                                 </option>
                                 <option value="Uttarakhand">Uttarakhand</option>
                                 <option value="West Bengal">West Bengal</option>
                              </select>
                           </div>
                        </div>
                        <div class="col-md-6">
                           <h6>City *</h6>
                           <div class="input-group">
                              <input type="text" class="form-control px-2" placeholder="Enter City Name" name="city">
                           </div>
                        </div>
                        <div class="col-md-6">
                           <h6>Area</h6>
                           <div class="input-group">
                              <input type="text" class="form-control px-2" placeholder="Enter Area Name" name="area">
                           </div>
                        </div>
                        <div class="col-md-6">
                           <h6>Pincode *</h6>
                           <div class="input-group">
                              <input type="number" class="form-control px-2" placeholder="Enter Pincode" name="pincode">
                           </div>
                        </div>
                        <div class="col-sm-12">
                           <button class="btn btn-primary">Submit</button>
                        </div>
                     </div>
                  </form>
               </div>
            </div>
         </div>
      </div>



      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

      <script>
         document.addEventListener('DOMContentLoaded', function () {
            var deleteButtons = document.querySelectorAll('.delete-btn');
            deleteButtons.forEach(function (button) {
               button.addEventListener('click', function (event) {
                  event.preventDefault();

                  var blogId = button.getAttribute('data-teacher-id');

                  // Show SweetAlert confirmation
                  Swal.fire({
                     title: 'Are you sure?',
                     text: 'You won\'t be able to revert this!',
                     icon: 'warning',
                     showCancelButton: true,
                     confirmButtonColor: '#d33',
                     cancelButtonColor: '#3085d6',
                     confirmButtonText: 'Yes, delete it!'
                  }).then(function (result) {
                     if (result.isConfirmed) {
                        window.location.href = '/admin/teacher_delete/' + blogId;
                     }
                  });
               });
            });
         });
      </script>


      <script>
         $(document).ready(function () {
            $('#report-table-page1').table({
               exportDataType: 'all',
               exportTypes: ['excel'],
               exportOptions: {
                  fileName: 'teacher_data',
                  ignoreColumn: [0],
               },
            });
         });

         function exportToExcel() {
            $('#report-table-page1').tableExport({ type: 'excel', escape: 'false' });
         }
      </script>


      <script>
         $(document).ready(function () {
            $('#report-table-page1').DataTable();


            $('#daterange-4').on('apply.daterangepicker', function (ev, picker) {
               var startDate = picker.startDate.toDate();
               var endDate = picker.endDate.toDate();
               $('.table-new tr').hide();

               $('.table-new tr').each(function () {
                  var rowDate = new Date($(this).find('td:eq(4)').text());

                  if (rowDate >= startDate && rowDate <= endDate) {
                     $(this).show();
                  }
               });
            });


            // City filter script
            function applyCityFilter() {
               var selectedCity = $('#cityFilter').val().trim().toLowerCase();
               $('.table-new tr').each(function () {
                  var cityInRow = $(this).find('td:eq(15)').text().trim().toLowerCase();
                  $(this).toggle(selectedCity === '' || cityInRow === selectedCity);
               });
            }

            $('#cityFilter').change(applyCityFilter);
            applyCityFilter();


            // School Type filter script
            function applySchoolTypeFilter() {
               var selectedSchoolType = $('#schoolTypeFilter').val().trim().toLowerCase();
               $('.table-new tr').each(function () {
                  var schoolTypeInRow = $(this).find('td:eq(10)').text().trim().toLowerCase();

                  $(this).toggle(selectedSchoolType === '' || schoolTypeInRow === selectedSchoolType);
               });
            }

            $('#schoolTypeFilter').change(applySchoolTypeFilter);
            applySchoolTypeFilter();


            // Role filter script
            function applyRoleFilter() {
               var selectedRole = $('#roleFilter').val().trim().toLowerCase();
               $('.table-new tr').each(function () {
                  var roleInRow = $(this).find('td:eq(17)').text().trim().toLowerCase();

                  $(this).toggle(selectedRole === '' || roleInRow === selectedRole);
               });
            }

            $('#roleFilter').change(applyRoleFilter);
            applyRoleFilter();



            // Qualification filter script
            function applyQualificationFilter() {
               var selectedQualification = $('#qualificationFilter').val().trim().toLowerCase();
               $('.table-new tr').each(function () {
                  var qualificationInRow = $(this).find('td:eq(14)').text().trim().toLowerCase();

                  $(this).toggle(selectedQualification === '' || qualificationInRow === selectedQualification);
               });
            }

            $('#qualificationFilter').change(applyQualificationFilter);
            applyQualificationFilter();


         });
      </script>



      <%- include('partials/footer.ejs') %>